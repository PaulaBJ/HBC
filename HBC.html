<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Constelaci√≥n del Coraz√≥n ‚Äî Interactivo</title>
  <style>
    :root{
      --bg:#050507; --star:#fff; --muted:#6b6b6b; --accent:#b02b3b; --hot:#ff69b4;
    }
  html,body {
    height:100%;
    margin:0;
    background: radial-gradient(circle at 20% 30%, #120812 0%, #0a0812 40%, #050508 100%),
                radial-gradient(circle at 80% 70%, #1c0d15 0%, transparent 70%),
                radial-gradient(circle at 50% 90%, #0a0d1a 0%, transparent 60%);
    background-blend-mode: screen;
    background-size: 200% 200%;
    animation: cosmicMove 20s ease-in-out infinite alternate;
    font-family: Georgia, 'Times New Roman', serif;
    color:var(--star);
    overflow:hidden;
  }

  @keyframes cosmicMove {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }
    canvas{display:block}
    #messageBox{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      background:rgba(0,0,0,0.92);padding:18px;border:2px solid rgba(255,255,255,0.06);
      border-radius:10px;max-width:520px;z-index:30;display:none;text-align:center;
      font-family: "Cinzel Decorative", serif;
    }
    #messageText{line-height:1.4;margin:0 0 10px 0}
    #messageBox button{
      background:var(--accent);border:none;color:#fff;padding:8px 14px;border-radius:8px;cursor:pointer;
      box-shadow: 0 3px 10px rgba(176,43,59,0.25);
    }
    #finalOverlay{
      position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);
      background:linear-gradient(180deg, rgba(0,0,0,0.9), rgba(10,5,8,0.98));
      padding:28px;border-radius:14px;border:1px solid rgba(255,255,255,0.06);
      z-index:40;display:none;max-width:640px;text-align:center;color:var(--hot);
    }
    #hint{position:fixed;left:18px;bottom:18px;color:var(--muted);font-size:0.95rem}
    small{color:var(--muted)}
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>

  <div id="messageBox" role="dialog" aria-modal="true" aria-labelledby="messageText">
    <p id="messageText"></p>
    <div><button id="closeBtn">Cerrar</button></div>
  </div>

  <div id="finalOverlay" role="status">
    <h2 style="margin:6px 0 12px 0">‚ú® Constelaci√≥n completa ‚ú®</h2>
    <p style="margin:0 0 12px 0;font-weight:600">Felicidades, mi amor. Tu legado no son solo los recuerdos, sino la persona luminosa y valiente que eres. 
      Gracias por existir, por tu risa que vence a la noche. 
      Feliz Cumplea√±os ü•≥ü•≥ü•≥!!!! Espero pases un excelente d√≠a y tambi√©n que me sigas acompa√±ando durante mucho m√°s tiempo. Ojal√° este peque√±o detalle te haya hecho sonre√≠r aunque sea un poco.
      Fue con todo mi amor y cari√±o ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è.</p>
  </div>

  <div id="hint"><small>Haz clic en la ESTRELLA brillante para comenzar.</small></div>

<script>
(() => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  let W = innerWidth, H = innerHeight;
  canvas.width = W; canvas.height = H;

  // Mensajes
  const messages = [
    "Tu voz es un conjuro que rompe mi penumbra.",
    "Como un verso perdido de Poe, tu mirada es mi abismo favorito.",
    "En tu silencio vibra la eternidad de mi deseo.",
    "Como un rezo pagano, tu nombre arde en mi pecho.",
    "En tus ojos reconozco un refugio m√°s seguro que cualquier amanecer.",
    "Tu voz es mi himno, mi plegaria susurrada al vac√≠o.",
    "Tu piel es el pergamino donde escribir√≠a mi historia infinita.",
    "En tus manos late un universo m√°s bello que cualquier constelaci√≥n.",
    "Como en los jardines secretos de Baudelaire, en ti florece mi deseo.",
    "Tu risa ilumina mis ruinas con un resplandor prohibido.",
    "Eres la marea que me arrastra hacia lo eterno.",
    "En tu sombra hall√© el hogar que nunca tuve.",
    "Como en un suspiro de The Cure, t√∫ eres mi eterna fascinaci√≥n.",
    "Eres mi sacrificio y mi redenci√≥n al mismo tiempo.",
    "Cada beso tuyo ser√≠a como un eclipse que me devora.",
    "Santa Sabina susurrar√≠a tu esencia entre notas infinitas.",
    "Eres el conjuro que me ata dulcemente a la noche.",
    "En ti, hasta el dolor es un fest√≠n sagrado.",
    "Tu piel es la liturgia que deseo leer eternamente.",
    "Eres mi catarsis, mi vicio y mi resurrecci√≥n.",
    "Como un bajo grave, tu amor me sacude desde dentro.",
    "Tu ausencia es un laberinto donde muero lentamente.",
    "Eres el v√©rtigo que me arrastra hacia la belleza oscura.",
    "Mi eternidad tiene tu forma y tu nombre.",
    "En tu sombra florecen mis delirios m√°s puros.",
    "Tus ojos son dos altares que reclaman mi devoci√≥n.",
    "Eres la plegaria nocturna que nunca dejo de repetir.",
    "En ti la noche nunca muere, siempre renace.",
    "Este coraz√≥n late solo por ti. üíú",
    "Eres el amor de mi vida y estoy feliz de tenerte en mi vida."
  ];

  const N = messages.length; // 29
  // heart parametric function scale + center
  const scaleBase = Math.min(W,H) * 0.045; // scale factor (auto)
  let offsetX = W/2, offsetY = H/2 + 30;
  
  // generate the N star positions using parametric heart (exact N points)
  let stars = [];
  function computeStars() {
      const W = canvas.width;
      const H = canvas.height;

      // Coordenadas param√©tricas del coraz√≥n
      let coords = [];
      const N = 30; // puntos, incluye inicio y fin
      for (let i = 0; i < N; i++) {
        const t = (2 * Math.PI * i) / (N - 1); // recorre 0..2œÄ
        const x = 16 * Math.pow(Math.sin(t), 3);
        const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
        coords.push({x, y});
      }

      // Calcular el rango real (bounding box)
      const minX = Math.min(...coords.map(p => p.x));
      const maxX = Math.max(...coords.map(p => p.x));
      const minY = Math.min(...coords.map(p => p.y));
      const maxY = Math.max(...coords.map(p => p.y));

      const heartWidth = maxX - minX;
      const heartHeight = maxY - minY;

      // Escala: quepa dentro de la pantalla con un margen
      const scale = Math.min(W / heartWidth, H / heartHeight) * 0.9;

      // Centro en el canvas
      const offsetX = W/2 - ((minX + maxX)/2) * scale;
      const offsetY = H/2 - ((minY + maxY)/2) * scale - H * 0.15;

      // Ajustar puntos escalados
      stars = coords.map(p => ({
        x: p.x * scale + offsetX,
        y: -p.y * scale + offsetY,
        shown: false
      }));
  }

  computeStars();
  window.addEventListener('resize', ()=>{ computeStars(); generateBg(); draw(); });

  // background stars (generated once)
  let bgStars = [];
  function generateBg(){
    bgStars = [];
    const count = Math.max(80, Math.floor((W*H)/8000));
    for(let i=0;i<count;i++){
      bgStars.push({ 
        x: Math.random()*W, 
        y: Math.random()*H, 
        r: Math.random()*1.2+0.3, 
        a: Math.random()*0.6+0.2,
        vx: (Math.random() - 0.5) * 0.3, // velocidad X lenta
        vy: (Math.random() - 0.5) * 0.3  // velocidad Y lenta
      });
    }
  }
  generateBg();

  // state
  let currentIndex = 0; // the star that should be clicked/opened next
  let showingBox = false;
  let revealedCount = 0; // number of stars already active (connected)
  const msgBox = document.getElementById('messageBox');
  const msgText = document.getElementById('messageText');
  const closeBtn = document.getElementById('closeBtn');
  const finalOverlay = document.getElementById('finalOverlay');

  closeBtn.addEventListener('click', () => closeMessage());

  function showMessage(index){
    if(index < 0 || index >= N) return;
    msgText.innerText = messages[index];
    msgBox.style.display = 'block';
    showingBox = true;
    closeBtn.focus();
  }

  function closeMessage(){
    msgBox.style.display = 'none';
    showingBox = false;
    // reveal this star and increment revealed
    if(currentIndex < stars.length){
      stars[currentIndex].active = true;
      revealedCount = Math.max(revealedCount, currentIndex+1);
    }
    // if finished all, show final overlay
    if(currentIndex >= N-1){
      // small delay to let last star draw
      setTimeout(()=> {
        finalOverlay.style.display = 'block';
      }, 450);
      return;
    }
    // advance to next star
    currentIndex++;
    // after a short pause, auto-open next message
    //setTimeout(()=> showMessage(currentIndex), 350);
  }

  // click handling: only open message when clicking near the "currentIndex" star
  canvas.addEventListener('click', (ev) => {
    if(showingBox) return; // wait until closed
    const rect = canvas.getBoundingClientRect();
    const mx = ev.clientX - rect.left, my = ev.clientY - rect.top;
    const s = stars[currentIndex];
    const d = Math.hypot(mx - s.x, my - s.y);
    if(d < 28){ // click near current star
      showMessage(currentIndex);
    }
  });

  // allow keyboard "Enter" to proceed when message box is visible
  window.addEventListener('keydown', (e)=> {
    if(e.key === 'Enter' && showingBox){ closeMessage(); }
  });

  // drawing loop
  function draw(){
    ctx.clearRect(0,0,W,H);
    // background subtle stars
    // background subtle stars
    ctx.save();
    for(const s of bgStars){
      s.x += s.vx;
      s.y += s.vy;

      // wrap-around: si sale de pantalla, vuelve por el otro lado
      if(s.x < 0) s.x = W;
      if(s.x > W) s.x = 0;
      if(s.y < 0) s.y = H;
      if(s.y > H) s.y = 0;

      ctx.globalAlpha = s.a * 0.9;
      ctx.fillStyle = '#fff';
      ctx.beginPath(); 
      ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); 
      ctx.fill();
    }
    ctx.restore();

    // draw connected line for revealed stars
    if(revealedCount > 0){
      ctx.beginPath();
      ctx.strokeStyle = 'rgba(255,255,255,0.95)';
      ctx.lineWidth = 2.2;
      ctx.lineJoin = 'round';
      ctx.moveTo(stars[0].x, stars[0].y);
      for(let i=1;i<revealedCount;i++){
        ctx.lineTo(stars[i].x, stars[i].y);
      }
      ctx.stroke();
    }

    // draw all stars
    for(let i=0;i<stars.length;i++){
      const st = stars[i];
      ctx.beginPath();
      const r = (i === currentIndex && !showingBox) ? 7 : (st.active ? 6 : 4);
      ctx.fillStyle = st.active ? 'rgba(255,105,180,1)' : ((i===currentIndex && !showingBox) ? '#fff' : '#6f6f6f');
      ctx.shadowColor = (st.active || (i===currentIndex && !showingBox)) ? 'rgba(255,105,180,0.8)' : 'transparent';
      ctx.shadowBlur = (st.active || (i===currentIndex && !showingBox)) ? 10 : 0;
      ctx.arc(st.x, st.y, r, 0, Math.PI*2);
      ctx.fill();
      ctx.shadowBlur = 0;
    }

    requestAnimationFrame(draw);
  }

  // Start: show small instruction and highlight first star (user clicks the first star)
  // Optionally, you can auto-open the first message by calling showMessage(0) here.
  // But per flow: user clicks the star to start, so we just draw and wait.
  draw();

})();
</script>

  <!-- M√∫sica de fondo -->
    <audio controls autoplay loop>
      <source src="data:audio/mp3;base64,AAAA..." type="audio/mp3">
      Tu navegador no soporta audio.
    </audio>

  <!-- Controles -->
  <div id="audioControls">
    <button id="muteBtn">üîä</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
  </div>


  <style>
    #audioControls {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 200;
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 14px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 3px 12px rgba(0,0,0,0.4);
    }

    #audioControls button {
      background: none;
      border: none;
      color: #fff;
      font-size: 22px;
      cursor: pointer;
    }

    #audioControls input[type="range"] {
      width: 120px;
      cursor: pointer;
    }
  </style>
<script>
    // üé∂ Script del audio (independiente del coraz√≥n/estrellas)
    const bgAudio = document.getElementById('bgAudio');
    const muteBtn = document.getElementById('muteBtn');
    const volumeSlider = document.getElementById('volumeSlider');

    let audioStarted = false;

    // üîπ Activa el audio en la primera interacci√≥n
    document.addEventListener('click', () => {
      if (!audioStarted) {
        bgAudio.volume = parseFloat(volumeSlider.value);
        bgAudio.play().catch(err => console.warn("Bloqueo de autoplay:", err));
        audioStarted = true;
      }
    });

    muteBtn.addEventListener('click', () => {
      bgAudio.muted = !bgAudio.muted;
      muteBtn.textContent = bgAudio.muted ? "üîá" : "üîä";
    });

    volumeSlider.addEventListener('input', e => {
      bgAudio.volume = parseFloat(e.target.value);
    });
</script>
</body>
</html>
